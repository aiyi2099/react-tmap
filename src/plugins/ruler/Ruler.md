# 测距组件

## 目标

![测试工具](../assets/rulers.png)


## 交互

1. 绘制 Overlayer 层，通过 [MapCanvasProjection](http://lbs.qq.com/javascript_v2/doc/mapcanvasprojection.html) 获取鼠标点所对应的地图经纬度 LatLng，然后通过 [spherical](http://lbs.qq.com/javascript_v2/doc/spherical.html) 测距函数，计算出两点的距离
2. 层上面鼠标事件交互
3. 单击事件逻辑：创建一个小圆圈 Circle 节点，白底红边不透明；如果是起点，则显示起点提示文案；如果非第一个点，创建一条虚线，虚线的起点为圆圈中心，zIndex 小于 Circle，使得虚线看起来起点从圆圈边缘开始，已经确定的点，提示文案提供删除点操作
4. 鼠标移动监听：实时计算上一个坐标点到当前鼠标点的距离，并在鼠标点处显示当前距离
5. 第 n > 1 次点击事件，重复 3，4 步骤，上一个点到当前点的线由虚线变实线
6. 删除点操作：删除一个点，则由当前点的上一个点，重新画一条直线连接当前点的下一个点
7. 右键或者双击，结束测距工具；


## 实现

### 组件划分

1. 自定义提示层组件：Tips
2. 一次完整测距组件，内部维护当前次测距信息，对外提供销毁接口和新建接口

### 容器组件

1. 组件内部维护一个二维数组，每次完成一次测距之后，下一次测距新增一个数组元素，数组元素包含一下信息：

   ``` js
   const result = [[{
       circles: [{ lat, lng, r}, ...], // 圆圈标记数组
       path: [{ lat, lng }, ...], // 测距路径
       tips: [dom, ...] // 提示框，包含相关操作
   }], ...]
   ```

   